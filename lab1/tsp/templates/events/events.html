{% extends "base.html" %}
{% load static %}

{% block content %}
<div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0;">
    <div id="map" style="width: 100%; height: 100%;"></div>
    <button id="logoutBtn" style="
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
        padding: 10px 20px;
        background: #dc3545;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 16px;
    ">Выход</button>
    <div id="status" style="position: absolute; top: 10px; left: 10px; background: white; padding: 5px; z-index: 1000;"></div>
</div>

<script>
function initMap() {
    try {
        const map = new ymaps.Map('map', {
            center: [55.76, 37.64], // Координаты Москвы
            zoom: 10,
            controls: ['zoomControl', 'typeSelector']
        });

    } catch (e) {
        document.getElementById('status').textContent = 'Ошибка: ' + e.message;
        console.error('Ошибка создания карты:', e);
    }
}

// Загрузка API с обработкой ошибок
const script = document.createElement('script');
script.src = 'https://api-maps.yandex.ru/2.1/?apikey=73768dcf-5edf-40ff-b1c9-d7a3fabadc62&lang=ru_RU';
script.onload = () => ymaps.ready(initMap);
script.onerror = () => {
    document.getElementById('status').textContent = 'Ошибка загрузки API карт';
    console.error('Не удалось загрузить API Яндекс.Карт');
};
document.head.appendChild(script);

    document.getElementById('logoutBtn').addEventListener('click', async function() {
    try {
        const response = await fetch('{% url "logout" %}', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'Content-Type': 'application/json'
            },
            credentials: 'include'
        });

        if (response.ok) {
            window.location.href = '{% url "login" %}';
        } else {
            console.error('Ошибка выхода:', await response.text());
        }
    } catch (error) {
        console.error('Ошибка:', error);
    }
});
</script>
{% endblock %}